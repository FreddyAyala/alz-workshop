# Module 4: Deploying the ALZ Hub Network

## Learning Objectives
After completing this module, you will be able to:
- Locate and understand the Terraform code generated by the ALZ Accelerator.
- Deploy the central hub virtual network, Azure Firewall, and other core connectivity resources.
- Validate the deployment of the hub network in the Azure portal.
- Understand how the deployed hub network enables the Hub-and-Spoke topology.

## Prerequisites
- Completion of Module 3 (ALZ Accelerator).
- An ALZ foundation successfully deployed using the `Deploy-Accelerator` command.

## From Foundation to Connectivity

In the previous module, the ALZ Accelerator laid the groundwork for our entire Azure platform. It created the management group hierarchy and assigned governance policies. It also generated a complete Terraform project, pre-configured to deploy the central platform resources, including networking.

Our next critical step is to deploy the **hub network**. This is the central point of connectivity for all of your application landing zones (spokes). All traffic, whether to the internet, on-premises, or between spokes, will be routed and secured through this hub.

```mermaid
graph TD;
    subgraph ALZ Foundation
        MGRoot[Management Groups]
        Policies[Azure Policies]
    end

    subgraph Hub Network (To Be Deployed)
        HubVNet[Hub Virtual Network]
        style HubVNet fill:#d4e6f1,stroke:#2980b9
        Firewall[Azure Firewall]
        style Firewall fill:#d4e6f1,stroke:#2980b9
        Gateway[VPN/ER Gateway]
        style Gateway fill:#d4e6f1,stroke:#2980b9
        Bastion[Azure Bastion]
        style Bastion fill:#d4e6f1,stroke:#2980b9
    end

    MGRoot --> HubVNet
    Policies --> HubVNet
    HubVNet --- Firewall & Gateway & Bastion
```

## Exploring the Generated Code

The ALZ Accelerator did more than just create Azure resources; it created a ready-to-use Terraform project.

Navigate to the output directory created by the accelerator:
```powershell
cd accelerator/output/local-output
```

Inside this directory, you will find a complete Terraform project, including:
-   A `main.tf` that calls the `platform_landing_zone` module.
-   A pre-configured `backend.tf` that points to the state storage account the accelerator created.
-   The `.tfvars` files that contain the specific configuration for your environment.

The accelerator has already done the hard work of writing and configuring the code to deploy the ALZ best-practice architecture. Our job is simply to execute it.

## Deploying the Hub Network

Because the accelerator has already configured the backend and variables, deploying the hub network is straightforward.

From within the `accelerator/output/local-output` directory, run the standard Terraform workflow:

1.  **Initialize Terraform:** This will download the necessary providers and connect to the remote state backend.
    ```bash
    terraform init
    ```

2.  **Review the Plan:** This command shows you exactly what resources Terraform will create. You will see it plans to create the VNet, Firewall, Public IPs, Route Tables, and more.
    ```bash
    terraform plan
    ```

3.  **Apply the Configuration:** This command will deploy the resources to Azure. This process can take 20-30 minutes, as services like Azure Firewall and Application Gateways take time to provision.
    ```bash
    terraform apply -auto-approve
    ```

### What Gets Deployed?
The default configuration of the accelerator's generated code will provision a comprehensive hub network, including:
-   **A Hub Virtual Network**: The central VNet for your platform.
-   **Azure Firewall**: For inspecting and securing all outbound, inbound, and spoke-to-spoke traffic.
-   **Azure Bastion**: For secure RDP/SSH access to virtual machines without public IPs.
-   **DDoS Protection**: To protect public-facing services.
-   **Supporting Resources**: Public IPs, route tables, and the necessary infrastructure for these services.

Once the deployment is complete, you will have a fully functional hub network, ready to provide connectivity and security for your application spokes.

---

**Next Module**: [Module 5: Vending Landing Zone Spoke Networks](05-vending-spokes.md)
